import { Hex, toBytes, toHex } from "viem";

import { Universe } from "../proto/definition";
import { encodeChainID36, OmniversalChainID } from "./chainid";
import { Currency } from "./currency";
import { zeroExtendBufToGivenSize } from "./zeroextn";

exports.RPCURLMap = new (class RPCURLMap {
  map = new Map([
    [encodeChainID36(Universe.ETHEREUM, 137), 'https://polygon-mainnet.g.alchemy.com/v2/PfaswrKq0rjOrfYWHfE9uLQKhiD4JCdq'],
    [encodeChainID36(Universe.ETHEREUM, 42161), 'https://arb-mainnet.g.alchemy.com/v2/PfaswrKq0rjOrfYWHfE9uLQKhiD4JCdq'],
    [encodeChainID36(Universe.ETHEREUM, 10), 'https://opt-mainnet.g.alchemy.com/v2/PfaswrKq0rjOrfYWHfE9uLQKhiD4JCdq'],
    [encodeChainID36(Universe.ETHEREUM, 8453), 'https://base-mainnet.g.alchemy.com/v2/PfaswrKq0rjOrfYWHfE9uLQKhiD4JCdq'],
    [encodeChainID36(Universe.ETHEREUM, 1), 'https://eth-mainnet.g.alchemy.com/v2/PfaswrKq0rjOrfYWHfE9uLQKhiD4JCdq'],
    [encodeChainID36(Universe.ETHEREUM, 534352), 'https://scroll-mainnet.g.alchemy.com/v2/PfaswrKq0rjOrfYWHfE9uLQKhiD4JCdq'],
    [encodeChainID36(Universe.ETHEREUM, 59144), 'https://linea-mainnet.g.alchemy.com/v2/PfaswrKq0rjOrfYWHfE9uLQKhiD4JCdq'],
    [encodeChainID36(Universe.FUEL, 9889), 'https://omniscient-fittest-pallet.fuel-mainnet.quiknode.pro/3193ae52f2522af1a4357a482e475e019857f02b/v1/graphql']
  ].map(z => [toHex(z[0]), z[1]]))

  get (key: Uint8Array) {
    return this.map.get(toHex(key))
  }
})()

class CurrencyMap {
  map = new Map<string, Currency>()

  constructor(currencies: Currency[]) {
    for (const cur of currencies) {
      this.map.set(toHex(cur.tokenAddress), cur)
    }
  }

  get(input: Parameters<typeof toBytes>[0]) {
    return this.map.get(toHex(zeroExtendBufToGivenSize(toBytes(input), 32)))
  }
}

export type ChainDatum = {
  ChainID: OmniversalChainID
  Universe: Universe
  ChainID32: Buffer
  Currencies: Currency[]
  CurrencyMap: CurrencyMap,
}

const RawData = [
  {
    "ChainID36": [
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      137
    ],
    "Universe": 0,
    "ChainID32": [
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      137
    ],
    "Currencies": [
      {
        "CurrencyID": 1,
        "TokenContractAddress": [
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          60,
          73,
          156,
          84,
          44,
          239,
          94,
          56,
          17,
          225,
          25,
          44,
          231,
          13,
          140,
          192,
          61,
          92,
          51,
          89
        ],
        "TokenDecimals": 6,
        "USDPriceOracleAddress": "0xfe4a8cc5b5b2366c1b58bea3858e81843581b2f7",
        "IsGasToken": false
      },
      {
        "CurrencyID": 2,
        "TokenContractAddress": [
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          194,
          19,
          45,
          5,
          211,
          28,
          145,
          74,
          135,
          198,
          97,
          28,
          16,
          116,
          138,
          235,
          4,
          181,
          142,
          143
        ],
        "TokenDecimals": 6,
        "USDPriceOracleAddress": "0x0a6513e40db6eb1b165753ad52e80663aea50545",
        "IsGasToken": false
      },
      {
        "CurrencyID": 4,
        "TokenContractAddress": [
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0
        ],
        "TokenDecimals": 18,
        "USDPriceOracleAddress": "0xab594600376ec9fd91f8e885dadf0ce036862de0",
        "IsGasToken": true
      }
    ],
    "GasToken": {
      "CurrencyID": 4,
      "TokenContractAddress": [
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0
      ],
      "TokenDecimals": 18,
      "USDPriceOracleAddress": "0xab594600376ec9fd91f8e885dadf0ce036862de0",
      "IsGasToken": true
    }
  },
  {
    "ChainID36": [
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      10
    ],
    "Universe": 0,
    "ChainID32": [
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      10
    ],
    "Currencies": [
      {
        "CurrencyID": 1,
        "TokenContractAddress": [
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          11,
          44,
          99,
          156,
          83,
          56,
          19,
          244,
          170,
          157,
          120,
          55,
          202,
          246,
          38,
          83,
          208,
          151,
          255,
          133
        ],
        "TokenDecimals": 6,
        "USDPriceOracleAddress": "0xfe4a8cc5b5b2366c1b58bea3858e81843581b2f7",
        "IsGasToken": false
      },
      {
        "CurrencyID": 2,
        "TokenContractAddress": [
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          148,
          176,
          8,
          170,
          0,
          87,
          156,
          19,
          7,
          176,
          239,
          44,
          73,
          154,
          217,
          138,
          140,
          229,
          142,
          88
        ],
        "TokenDecimals": 6,
        "USDPriceOracleAddress": "0x0a6513e40db6eb1b165753ad52e80663aea50545",
        "IsGasToken": false
      },
      {
        "CurrencyID": 3,
        "TokenContractAddress": [
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0,
          0
        ],
        "TokenDecimals": 18,
        "USDPriceOracleAddress": "0xf9680d99d6c9589e2a93a78a04a279e509205945",
        "IsGasToken": true
      }
    ],
    "GasToken": {
      "CurrencyID": 3,
      "TokenContractAddress": [
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0,
        0
      ],
      "TokenDecimals": 18,
      "USDPriceOracleAddress": "0xf9680d99d6c9589e2a93a78a04a279e509205945",
      "IsGasToken": true
    }
  },
  {
    "ChainID36": [
      0,
      0,
      0,
      1,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      38,
      161
    ],
    "Universe": 1,
    "ChainID32": [
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      0,
      38,
      161
    ],
    "Currencies": [
      {
        "CurrencyID": 1,
        "TokenContractAddress": [
          40,
          108,
          71,
          157,
          164,
          13,
          201,
          83,
          189,
          220,
          59,
          180,
          196,
          83,
          182,
          8,
          187,
          162,
          224,
          172,
          72,
          59,
          7,
          123,
          212,
          117,
          23,
          65,
          21,
          57,
          94,
          107
        ],
        "TokenDecimals": 6,
        "USDPriceOracleAddress": "0xfe4a8cc5b5b2366c1b58bea3858e81843581b2f7",
        "IsGasToken": false
      },
      {
        "CurrencyID": 2,
        "TokenContractAddress": [
          160,
          38,
          95,
          181,
          195,
          47,
          110,
          141,
          179,
          25,
          122,
          243,
          199,
          235,
          5,
          196,
          138,
          227,
          115,
          96,
          91,
          129,
          101,
          182,
          244,
          165,
          28,
          91,
          11,
          164,
          129,
          46
        ],
        "TokenDecimals": 6,
        "USDPriceOracleAddress": "0x0a6513e40db6eb1b165753ad52e80663aea50545",
        "IsGasToken": false
      },
      {
        "CurrencyID": 3,
        "TokenContractAddress": [
          248,
          248,
          182,
          40,
          61,
          127,
          165,
          182,
          114,
          181,
          48,
          203,
          184,
          79,
          204,
          203,
          79,
          248,
          220,
          64,
          248,
          23,
          110,
          244,
          84,
          77,
          219,
          31,
          25,
          82,
          173,
          7
        ],
        "TokenDecimals": 9,
        "USDPriceOracleAddress": "0xf9680d99d6c9589e2a93a78a04a279e509205945",
        "IsGasToken": true
      }
    ],
    "GasToken": {
      "CurrencyID": 3,
      "TokenContractAddress": [
        248,
        248,
        182,
        40,
        61,
        127,
        165,
        182,
        114,
        181,
        48,
        203,
        184,
        79,
        204,
        203,
        79,
        248,
        220,
        64,
        248,
        23,
        110,
        244,
        84,
        77,
        219,
        31,
        25,
        82,
        173,
        7
      ],
      "TokenDecimals": 9,
      "USDPriceOracleAddress": "0xf9680d99d6c9589e2a93a78a04a279e509205945",
      "IsGasToken": true
    }
  }
]

// Certain data fields are auto-generated while others are not.
export const Chaindata: ChainDatum[] = RawData.map(ch => {
  const ch32 = Buffer.from(ch.ChainID32)
  const currencies = ch.Currencies.map(cur => {
    return new Currency(cur.CurrencyID, ch.Universe, Buffer.from(cur.TokenContractAddress), cur.TokenDecimals, cur.IsGasToken, cur.USDPriceOracleAddress as Hex)
  })
  return {
    Universe: ch.Universe,
    ChainID: new OmniversalChainID(ch.Universe, ch32),
    ChainID32: ch32,
    Currencies: currencies,
    CurrencyMap: new CurrencyMap(currencies),
  }
})
